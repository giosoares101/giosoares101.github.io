<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');d.add('dark');if("system"===e||(!e&&false)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>CDN Caching, Static Site Generation and Server Side Rendering</title><meta name="robots" content="follow, index"/><meta name="description" content="Here we are analyzing the different types of pre rendering a website and its combination with a CDN."/><meta property="og:url" content="https://giosoares101.github.io//blog/cdn-and-server-side-rendering"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Giovanni Soares"/><meta property="og:description" content="Here we are analyzing the different types of pre rendering a website and its combination with a CDN."/><meta property="og:title" content="CDN Caching, Static Site Generation and Server Side Rendering"/><meta property="og:image" content="https://giosoares101.github.io//static/images/cdn-and-server-side-rendering.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="CDN Caching, Static Site Generation and Server Side Rendering"/><meta name="twitter:description" content="Here we are analyzing the different types of pre rendering a website and its combination with a CDN."/><meta name="twitter:image" content="https://giosoares101.github.io//static/images/cdn-and-server-side-rendering.png"/><link rel="canonical" href="https://giosoares101.github.io//blog/cdn-and-server-side-rendering"/><meta property="article:published_time" content="2022-09-04T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://giosoares101.github.io//blog/cdn-and-server-side-rendering"
  },
  "headline": "CDN Caching, Static Site Generation and Server Side Rendering",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://giosoares101.github.io//static/images/cdn-and-server-side-rendering.png"
    }
  ],
  "datePublished": "2022-09-04T00:00:00.000Z",
  "dateModified": "2022-09-04T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Giovanni Soares"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Giovanni Soares",
    "logo": {
      "@type": "ImageObject",
      "url": "https://giosoares101.github.io//static/images/logo.png"
    }
  },
  "description": "Here we are analyzing the different types of pre rendering a website and its combination with a CDN."
}</script><meta name="next-head-count" content="20"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/911b0e6eb2decf42.css" as="style"/><link rel="stylesheet" href="/_next/static/css/911b0e6eb2decf42.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-5f80f3076149bc7d.js" defer=""></script><script src="/_next/static/chunks/main-7b3ba9bf4f28f1fe.js" defer=""></script><script src="/_next/static/chunks/pages/_app-03eeb0dc71c5e69c.js" defer=""></script><script src="/_next/static/chunks/675-70b09cbf0a5309ea.js" defer=""></script><script src="/_next/static/chunks/774-12915c1efed9eab5.js" defer=""></script><script src="/_next/static/chunks/833-344f4ccb1d4a2701.js" defer=""></script><script src="/_next/static/chunks/712-681182ab78f3693b.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-832cad689911973f.js" defer=""></script><script src="/_next/static/1-x9ckl1UwmdQP7SVg0Aq/_buildManifest.js" defer=""></script><script src="/_next/static/1-x9ckl1UwmdQP7SVg0Aq/_ssgManifest.js" defer=""></script><script src="/_next/static/1-x9ckl1UwmdQP7SVg0Aq/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-6"><div><a aria-label="Gio Soares&#x27;s website" class="hover:dark:text-primary-color-dark hover:text-primary-color p-1 font-serif font-medium text-2xl text-gray-900 dark:text-gray-100 sm:p-4" href="/">Giovanni Soares</a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="hover:dark:text-primary-color-dark hover:text-primary-color p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about">About</a><a class="hover:dark:text-primary-color-dark hover:text-primary-color p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/projects">Projects</a><a class="hover:dark:text-primary-color-dark hover:text-primary-color p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="hover:dark:text-primary-color-dark hover:text-primary-color p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div><div class="px-12 py-4"><a class="text-2xl tracking-widest text-gray-900 dark:text-gray-100" href="/projects">Projects</a></div><div class="px-12 py-4"><a class="text-2xl tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2022-09-04T00:00:00.000Z">Sunday, September 4, 2022</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">CDN Caching, Static Site Generation and Server Side Rendering</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" src="/static/images/photo.jpg" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Giovanni Soares</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><details open=""><summary class="ml-6 pt-2 pb-2 text-xl font-bold">Table of Contents</summary><div class="ml-6"><ul><li class="false"><a href="#static-site-generation">Static Site Generation</a></li><li class="false"><a href="#server-side-rendering-without-cdn">Server Side Rendering without CDN</a></li><li class="false"><a href="#server-side-rendering-with-cdn">Server Side Rendering with CDN</a></li><li class="false"><a href="#incremental-static-site-regeneration">Incremental Static Site Regeneration</a></li><li class="false"><a href="#server-side-rendering-with-stale-while-revalidate">Server Side Rendering with Stale While Revalidate</a></li><li class="false"><a href="#resources">Resources</a></li></ul></div></details><p>Here we are analyzing the different types of pre-rendering a website and its combination with a CDN.</p><h2 id="static-site-generation"><a href="#static-site-generation" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Static Site Generation</h2><p>Every single page of a website is first built and then uploaded to a CDN. The best part of this is that, as the website is static, the user does not have to interact with the server. The CDN can directly return the static generated site, so the user gets a <strong>fast response</strong>.</p><p>The disadvantage is that every time you want to update the website you have to build the whole website again and upload it to the CDN. This costs money.</p><h2 id="server-side-rendering-without-cdn"><a href="#server-side-rendering-without-cdn" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Server Side Rendering without CDN</h2><p>Pages are built on demand with Server Side Rendering. When a user requests a page the user has to wait until the page is built and returned from the server. Because of this, <strong>response time is slow</strong>.</p><p>Every visit to a page generates a build. In comparison to Static Site Generation where every page is always built, here <strong>only the pages that are visited are built</strong>. If no one visits a page, it is never built.</p><p>The disadvantage is that for every request we have to build the page.</p><h2 id="server-side-rendering-with-cdn"><a href="#server-side-rendering-with-cdn" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Server Side Rendering with CDN</h2><p>In this case the first visitor of a page requests the page to the CDN and the CDN requests it to the server which builds it and returns it back. But for the second visitor the CDN will already have the page at cache and can directly return it without generating a new build.</p><p>The problem here is that every next visitor is going to receive the build that was generated for the first visitor. What happens if the page is stale? With <a target="_blank" rel="noopener noreferrer" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control#response_directives">max-age</a> we can control how long the page can be cached. When the page is stale, the CDN will request a new build on the next request after <code>max-age</code>. Depending on the kind of the page we could set a different <code>max-age</code>.</p><p>We can combine <code>max-age</code> with <code>s-maxage</code>. The CDN will cache a page using <code>s-maxage</code> instead of <code>max-age</code> if it is present. User&#x27;s browser will ignore <code>s-maxage</code>. This can be very useful if we purge the website pages in the CDN when they are rebuilt.</p><p>As we don&#x27;t have control over the user&#x27;s browser, we should have a <code>max-age</code> that is lower than the <code>s-maxage</code>, otherwise, we could have an updated version of a page in the CDN which the user would never request because the user&#x27;s browser had an older version which would be still valid according to <code>max-age</code>.</p><p>For example, we could set a <code>max-age</code> of one minute or one day and a <code>s-maxage</code> of one year. This way the user would request the page to the CDN frequently and the CDN would never request a new build because according to <code>s-maxage</code> the page would still be valid. We would update the cache on the CDN by purging the previous page and uploading the new one.</p><h2 id="incremental-static-site-regeneration"><a href="#incremental-static-site-regeneration" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Incremental Static Site Regeneration</h2><p>Initially the whole website is built and uploaded to the CDN as with Static Site Generation. But here if a user requests a page the CDN will return the current cached page and it will also request to the server a new build of <strong>only that page</strong>. This way, <strong>the next user will get the new build</strong> and the CDN will again request a new one to the server.</p><p>Every user gets a fast response and only the pages that are requested are updated.</p><p>This is a technique used by Next.js, I recommend reading <a target="_blank" rel="noopener noreferrer" href="https://nextjs.org/docs/basic-features/data-fetching/incremental-static-regeneration">their documentation</a> to get a better understanding of this.</p><h2 id="server-side-rendering-with-stale-while-revalidate"><a href="#server-side-rendering-with-stale-while-revalidate" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Server Side Rendering with Stale While Revalidate</h2><p><a target="_blank" rel="noopener noreferrer" href="https://web.dev/stale-while-revalidate/">stale-while-revalidate</a> can be added to the <code>cache-control</code> header. What does it do? If a request comes after <code>max-age</code> the CDN returns a stale version of the page while the server is building a fresh one. <code>stale-while-revalidate</code> specifies in seconds for how long can the stale version be returned.</p><p>The first time a user requests a page it will be generated in the server and uploaded to the CDN. If a new request comes before <code>max-age</code> then the CDN will just return it. If a request comes after <code>max-age</code> then the CDN will return the stale version but this time it will request the server a new fresh copy. Every user that requests the page while it is being built will get the stale version.</p><p>If after <code>max-age</code> a request comes and <code>stale-while-revalidate</code> has also passed, then the CDN won&#x27;t return a stale version and it will wait until a new version is generated in the server.</p><p>From the user&#x27;s perspective it is exactly the same as Incremental Static Site Regeneration. Only that here we don&#x27;t have to build the whole website for the first deployment, the first visitor will trigger the build of the page that he&#x27;s visiting.</p><h2 id="resources"><a href="#resources" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Resources</h2><ul><li><a target="_blank" rel="noopener noreferrer" href="https://nextjs.org/docs/basic-features/data-fetching/incremental-static-regeneration">Next.js documentation</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://web.dev/stale-while-revalidate/">Web.dev stale-while-revalidate</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control">MDN cache-control</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://www.youtube.com/watch?v=bfLFHp7Sbkg">Youtube.com CDN Caching, Static Site Generation, and Server Side Rendering</a></li></ul></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/static-site-generation">static-site-generation</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/server-side-rendering">server-side-rendering</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/cdn">cdn</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/cache">cache</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/typescript">Intro to TypeScript</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/firebase">Firebase - Authentication and Database</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-10 mb-4 flex flex-col items-center justify-between md:flex-row"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/giosoares101"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-5 w-5"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:gioarmstr11@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-5 w-5"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/giovanni-soares-818b02327"><span class="sr-only">linkedin</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-5 w-5"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a></div><div class="mb-3 flex space-x-2 text-sm text-gray-500 dark:text-gray-400">I am ready to be hired at anytime, Have a good <!-- -->Friday<!-- -->!</div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var l=Object.create;var n=Object.defineProperty;var c=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var g=Object.getPrototypeOf,p=Object.prototype.hasOwnProperty;var h=i=\u003en(i,\"__esModule\",{value:!0});var w=(i,r)=\u003e()=\u003e(r||i((r={exports:{}}).exports,r),r.exports),v=(i,r)=\u003e{h(i);for(var a in r)n(i,a,{get:r[a],enumerable:!0})},f=(i,r,a)=\u003e{if(r\u0026\u0026typeof r==\"object\"||typeof r==\"function\")for(let t of u(r))!p.call(i,t)\u0026\u0026t!==\"default\"\u0026\u0026n(i,t,{get:()=\u003er[t],enumerable:!(a=c(r,t))||a.enumerable});return i},m=i=\u003ef(h(n(i!=null?l(g(i)):{},\"default\",i\u0026\u0026i.__esModule\u0026\u0026\"default\"in i?{get:()=\u003ei.default,enumerable:!0}:{value:i,enumerable:!0})),i);var o=w((S,d)=\u003e{d.exports=_jsx_runtime});var N={};v(N,{default:()=\u003ey,frontmatter:()=\u003eb});var e=m(o()),b={title:\"CDN Caching, Static Site Generation and Server Side Rendering\",summary:\"Here we are analyzing the different types of pre rendering a website and its combination with a CDN.\",date:\"2022-09-04\",tags:[\"static-site-generation\",\"server-side-rendering\",\"cdn\",\"cache\"],images:[\"/static/images/cdn-and-server-side-rendering.png\"],draft:!1,urls:[\"https://dev.to/jmalvarez/cdn-caching-static-site-generation-and-server-side-rendering-4hom\"],dev_to:\"https://dev.to/jmalvarez/cdn-caching-static-site-generation-and-server-side-rendering-4hom\"};function x(i={}){let{wrapper:r}=i.components||{};return r?(0,e.jsx)(r,Object.assign({},i,{children:(0,e.jsx)(a,{})})):a();function a(){let t=Object.assign({p:\"p\",h2:\"h2\",a:\"a\",span:\"span\",strong:\"strong\",code:\"code\",ul:\"ul\",li:\"li\"},i.components),{TOCInline:s}=t;return s||C(\"TOCInline\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(s,{toc:i.toc,asDisclosure:!0}),(0,e.jsx)(t.p,{children:\"Here we are analyzing the different types of pre-rendering a website and its combination with a CDN.\"}),(0,e.jsxs)(t.h2,{id:\"static-site-generation\",children:[(0,e.jsx)(t.a,{href:\"#static-site-generation\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(t.span,{className:\"icon icon-link\"})}),\"Static Site Generation\"]}),(0,e.jsxs)(t.p,{children:[\"Every single page of a website is first built and then uploaded to a CDN. The best part of this is that, as the website is static, the user does not have to interact with the server. The CDN can directly return the static generated site, so the user gets a \",(0,e.jsx)(t.strong,{children:\"fast response\"}),\".\"]}),(0,e.jsx)(t.p,{children:\"The disadvantage is that every time you want to update the website you have to build the whole website again and upload it to the CDN. This costs money.\"}),(0,e.jsxs)(t.h2,{id:\"server-side-rendering-without-cdn\",children:[(0,e.jsx)(t.a,{href:\"#server-side-rendering-without-cdn\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(t.span,{className:\"icon icon-link\"})}),\"Server Side Rendering without CDN\"]}),(0,e.jsxs)(t.p,{children:[\"Pages are built on demand with Server Side Rendering. When a user requests a page the user has to wait until the page is built and returned from the server. Because of this, \",(0,e.jsx)(t.strong,{children:\"response time is slow\"}),\".\"]}),(0,e.jsxs)(t.p,{children:[\"Every visit to a page generates a build. In comparison to Static Site Generation where every page is always built, here \",(0,e.jsx)(t.strong,{children:\"only the pages that are visited are built\"}),\". If no one visits a page, it is never built.\"]}),(0,e.jsx)(t.p,{children:\"The disadvantage is that for every request we have to build the page.\"}),(0,e.jsxs)(t.h2,{id:\"server-side-rendering-with-cdn\",children:[(0,e.jsx)(t.a,{href:\"#server-side-rendering-with-cdn\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(t.span,{className:\"icon icon-link\"})}),\"Server Side Rendering with CDN\"]}),(0,e.jsx)(t.p,{children:\"In this case the first visitor of a page requests the page to the CDN and the CDN requests it to the server which builds it and returns it back. But for the second visitor the CDN will already have the page at cache and can directly return it without generating a new build.\"}),(0,e.jsxs)(t.p,{children:[\"The problem here is that every next visitor is going to receive the build that was generated for the first visitor. What happens if the page is stale? With \",(0,e.jsx)(t.a,{href:\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control#response_directives\",children:\"max-age\"}),\" we can control how long the page can be cached. When the page is stale, the CDN will request a new build on the next request after \",(0,e.jsx)(t.code,{children:\"max-age\"}),\". Depending on the kind of the page we could set a different \",(0,e.jsx)(t.code,{children:\"max-age\"}),\".\"]}),(0,e.jsxs)(t.p,{children:[\"We can combine \",(0,e.jsx)(t.code,{children:\"max-age\"}),\" with \",(0,e.jsx)(t.code,{children:\"s-maxage\"}),\". The CDN will cache a page using \",(0,e.jsx)(t.code,{children:\"s-maxage\"}),\" instead of \",(0,e.jsx)(t.code,{children:\"max-age\"}),\" if it is present. User's browser will ignore \",(0,e.jsx)(t.code,{children:\"s-maxage\"}),\". This can be very useful if we purge the website pages in the CDN when they are rebuilt.\"]}),(0,e.jsxs)(t.p,{children:[\"As we don't have control over the user's browser, we should have a \",(0,e.jsx)(t.code,{children:\"max-age\"}),\" that is lower than the \",(0,e.jsx)(t.code,{children:\"s-maxage\"}),\", otherwise, we could have an updated version of a page in the CDN which the user would never request because the user's browser had an older version which would be still valid according to \",(0,e.jsx)(t.code,{children:\"max-age\"}),\".\"]}),(0,e.jsxs)(t.p,{children:[\"For example, we could set a \",(0,e.jsx)(t.code,{children:\"max-age\"}),\" of one minute or one day and a \",(0,e.jsx)(t.code,{children:\"s-maxage\"}),\" of one year. This way the user would request the page to the CDN frequently and the CDN would never request a new build because according to \",(0,e.jsx)(t.code,{children:\"s-maxage\"}),\" the page would still be valid. We would update the cache on the CDN by purging the previous page and uploading the new one.\"]}),(0,e.jsxs)(t.h2,{id:\"incremental-static-site-regeneration\",children:[(0,e.jsx)(t.a,{href:\"#incremental-static-site-regeneration\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(t.span,{className:\"icon icon-link\"})}),\"Incremental Static Site Regeneration\"]}),(0,e.jsxs)(t.p,{children:[\"Initially the whole website is built and uploaded to the CDN as with Static Site Generation. But here if a user requests a page the CDN will return the current cached page and it will also request to the server a new build of \",(0,e.jsx)(t.strong,{children:\"only that page\"}),\". This way, \",(0,e.jsx)(t.strong,{children:\"the next user will get the new build\"}),\" and the CDN will again request a new one to the server.\"]}),(0,e.jsx)(t.p,{children:\"Every user gets a fast response and only the pages that are requested are updated.\"}),(0,e.jsxs)(t.p,{children:[\"This is a technique used by Next.js, I recommend reading \",(0,e.jsx)(t.a,{href:\"https://nextjs.org/docs/basic-features/data-fetching/incremental-static-regeneration\",children:\"their documentation\"}),\" to get a better understanding of this.\"]}),(0,e.jsxs)(t.h2,{id:\"server-side-rendering-with-stale-while-revalidate\",children:[(0,e.jsx)(t.a,{href:\"#server-side-rendering-with-stale-while-revalidate\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(t.span,{className:\"icon icon-link\"})}),\"Server Side Rendering with Stale While Revalidate\"]}),(0,e.jsxs)(t.p,{children:[(0,e.jsx)(t.a,{href:\"https://web.dev/stale-while-revalidate/\",children:\"stale-while-revalidate\"}),\" can be added to the \",(0,e.jsx)(t.code,{children:\"cache-control\"}),\" header. What does it do? If a request comes after \",(0,e.jsx)(t.code,{children:\"max-age\"}),\" the CDN returns a stale version of the page while the server is building a fresh one. \",(0,e.jsx)(t.code,{children:\"stale-while-revalidate\"}),\" specifies in seconds for how long can the stale version be returned.\"]}),(0,e.jsxs)(t.p,{children:[\"The first time a user requests a page it will be generated in the server and uploaded to the CDN. If a new request comes before \",(0,e.jsx)(t.code,{children:\"max-age\"}),\" then the CDN will just return it. If a request comes after \",(0,e.jsx)(t.code,{children:\"max-age\"}),\" then the CDN will return the stale version but this time it will request the server a new fresh copy. Every user that requests the page while it is being built will get the stale version.\"]}),(0,e.jsxs)(t.p,{children:[\"If after \",(0,e.jsx)(t.code,{children:\"max-age\"}),\" a request comes and \",(0,e.jsx)(t.code,{children:\"stale-while-revalidate\"}),\" has also passed, then the CDN won't return a stale version and it will wait until a new version is generated in the server.\"]}),(0,e.jsx)(t.p,{children:\"From the user's perspective it is exactly the same as Incremental Static Site Regeneration. Only that here we don't have to build the whole website for the first deployment, the first visitor will trigger the build of the page that he's visiting.\"}),(0,e.jsxs)(t.h2,{id:\"resources\",children:[(0,e.jsx)(t.a,{href:\"#resources\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(t.span,{className:\"icon icon-link\"})}),\"Resources\"]}),(0,e.jsxs)(t.ul,{children:[(0,e.jsx)(t.li,{children:(0,e.jsx)(t.a,{href:\"https://nextjs.org/docs/basic-features/data-fetching/incremental-static-regeneration\",children:\"Next.js documentation\"})}),(0,e.jsx)(t.li,{children:(0,e.jsx)(t.a,{href:\"https://web.dev/stale-while-revalidate/\",children:\"Web.dev stale-while-revalidate\"})}),(0,e.jsx)(t.li,{children:(0,e.jsx)(t.a,{href:\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control\",children:\"MDN cache-control\"})}),(0,e.jsx)(t.li,{children:(0,e.jsx)(t.a,{href:\"https://www.youtube.com/watch?v=bfLFHp7Sbkg\",children:\"Youtube.com CDN Caching, Static Site Generation, and Server Side Rendering\"})})]})]})}}var y=x;function C(i,r){throw new Error(\"Expected \"+(r?\"component\":\"object\")+\" `\"+i+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return N;})();\n;return Component;","toc":[{"value":"Static Site Generation","url":"#static-site-generation","depth":2},{"value":"Server Side Rendering without CDN","url":"#server-side-rendering-without-cdn","depth":2},{"value":"Server Side Rendering with CDN","url":"#server-side-rendering-with-cdn","depth":2},{"value":"Incremental Static Site Regeneration","url":"#incremental-static-site-regeneration","depth":2},{"value":"Server Side Rendering with Stale While Revalidate","url":"#server-side-rendering-with-stale-while-revalidate","depth":2},{"value":"Resources","url":"#resources","depth":2}],"frontMatter":{"readingTime":{"text":"5 min read","minutes":4.365,"time":261900,"words":873},"slug":"cdn-and-server-side-rendering","fileName":"cdn-and-server-side-rendering.mdx","title":"CDN Caching, Static Site Generation and Server Side Rendering","summary":"Here we are analyzing the different types of pre rendering a website and its combination with a CDN.","date":"2022-09-04T00:00:00.000Z","tags":["static-site-generation","server-side-rendering","cdn","cache"],"images":["/static/images/cdn-and-server-side-rendering.png"],"draft":false,"urls":["https://dev.to/jmalvarez/cdn-caching-static-site-generation-and-server-side-rendering-4hom"],"dev_to":"https://dev.to/jmalvarez/cdn-caching-static-site-generation-and-server-side-rendering-4hom"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.76,"time":45600,"words":152},"slug":["default"],"fileName":"default.md","name":"Giovanni Soares","avatar":"/static/images/photo.jpg","occupation":"Senior Web Developer \u0026 Software Engineer","company":null,"email":"gioarmstr11@gmail.com","twitter":null,"linkedin":null,"github":"https://github.com/giosoares101","date":null}],"prev":{"title":"Intro to TypeScript","date":"2022-08-31T00:00:00.000Z","images":"https://i0.wp.com/css-tricks.com/wp-content/uploads/2022/01/typescript-logo.png?fit=1200%2C600\u0026ssl=1","tags":["Typescript"],"draft":false,"summary":"A quick introduction to TypeScript.","slug":"typescript"},"next":{"title":"Firebase - Authentication and Database","date":"2022-10-27T00:00:00.000Z","tags":["Firebase","Database","Authentication"],"draft":false,"summary":"Basics of using Firebase for authentication and database storage. Covers how to set up a project, create a database, and authenticate users in a React app.","slug":"firebase"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["cdn-and-server-side-rendering"]},"buildId":"1-x9ckl1UwmdQP7SVg0Aq","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>